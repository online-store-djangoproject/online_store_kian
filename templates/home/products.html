<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لیست محصولات</title>

    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">

    <div class="container mx-auto p-4">
        <!-- نوار جستجو و مرتب‌سازی -->
        <div class="flex space-x-4 mb-4">
            <input type="text" id="search" placeholder="جستجوی محصول..."
                   class="p-2 border rounded w-1/2">

            <select id="sort" class="p-2 border rounded">
                <option value="">مرتب‌سازی</option>
                <option value="price_asc">قیمت: کم به زیاد</option>
                <option value="price_desc">قیمت: زیاد به کم</option>
            </select>
        </div>

        <!-- لیست محصولات -->
        <div id="productsList" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>
    </div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
    const searchInput = document.getElementById("search");
    const sortSelect = document.getElementById("sort");
    const productsList = document.getElementById("productsList");

    async function fetchProducts() {
        try {
            let url = "http://127.0.0.1:8000/products/";

            // افزودن پارامترهای جستجو و مرتب‌سازی به URL
            const searchValue = searchInput.value.trim();
            const sortValue = sortSelect.value;

            if (searchValue) url += `?search=${searchValue}`;
            if (sortValue === "price_asc") url += "&ordering=price";
            if (sortValue === "price_desc") url += "&ordering=-price";

            let response = await fetch(url);
            let data = await response.json();
            displayProducts(data);
        } catch (error) {
            console.error("خطا در دریافت محصولات:", error);
        }
    }

    function displayProducts(products) {
        productsList.innerHTML = "";
        products.forEach(product => {
            let productCard = document.createElement("div");
            productCard.className = "bg-white p-4 rounded shadow";

            productCard.innerHTML = `
                <img src="${product.image || 'default.jpg'}" class="w-full h-40 object-cover rounded">
                <h2 class="text-lg font-bold mt-2">${product.name}</h2>
                <p>${product.description}</p>
                <p class="text-green-600 font-bold">${product.price} تومان</p>
                <button onclick="viewProductDetails('${product.id}')"
                        class="mt-2 bg-blue-500 text-white p-2 rounded">
                        جزئیات
                </button>
            `;

            productsList.appendChild(productCard);
        });
    }

    function viewProductDetails(productId) {
        window.location.href = `product_details.html?id=${productId}`;
    }

    searchInput.addEventListener("input", fetchProducts);
    sortSelect.addEventListener("change", fetchProducts);

    fetchProducts();
});

</script>
</body>
</html>
