<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø¢Ù†Ù„Ø§ÛŒÙ†</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 p-4">
<!-- Ù‚Ø³Ù…Øª Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ -->
<div class="mb-4">
    <h2 class="text-lg font-bold">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</h2>
    <div id="categories-list" class="flex gap-2 mt-2"></div>
</div>

    <!-- Ù‚Ø³Ù…Øª Ø¬Ø³ØªØ¬Ùˆ Ùˆ Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ -->
    <div class="mb-4 flex gap-2">
        <input type="text" id="search" class="p-2 border rounded w-1/2" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ù…Ø­ØµÙˆÙ„...">
        <select id="sort" class="p-2 border rounded">
            <option value="default">Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ</option>
            <option value="price-asc">Ù‚ÛŒÙ…Øª: Ú©Ù… Ø¨Ù‡ Ø²ÛŒØ§Ø¯</option>
            <option value="price-desc">Ù‚ÛŒÙ…Øª: Ø²ÛŒØ§Ø¯ Ø¨Ù‡ Ú©Ù…</option>
        </select>
    </div>

    <!-- Ù„ÛŒØ³Øª Ù…Ø­ØµÙˆÙ„Ø§Øª -->
    <div id="products-list" class="grid grid-cols-1 md:grid-cols-3 gap-4"></div>

    <!-- Ù†Ù…Ø§ÛŒØ´ Ø¬Ø²Ø¦ÛŒØ§Øª Ù…Ø­ØµÙˆÙ„ -->
    <div id="product-details" class="hidden p-4 bg-white shadow rounded mt-4">
        <button onclick="closeDetails()" class="bg-red-500 text-white px-3 py-1 rounded">Ø¨Ø³ØªÙ†</button>
        <h2 id="product-name" class="text-xl font-bold mt-2"></h2>
        <img id="product-image" class="w-64 h-64 object-cover mt-2" />
        <p id="product-description" class="mt-2"></p>
        <p id="product-price" class="font-bold text-lg mt-2"></p>
        <h3 class="text-lg font-semibold mt-4">Ù†Ø¸Ø±Ø§Øª:</h3>
        <ul id="reviews-list" class="mt-2"></ul>

        <!-- ÙØ±Ù… Ø§ÙØ²ÙˆØ¯Ù† Ù†Ø¸Ø± -->
        <h3 class="text-lg font-semibold mt-4">Ø§ÙØ²ÙˆØ¯Ù† Ù†Ø¸Ø± Ø¬Ø¯ÛŒØ¯:</h3>
        <input type="text" id="review-name" class="p-2 border rounded w-full mt-2" placeholder="Ù†Ø§Ù… Ø´Ù…Ø§">
        <textarea id="review-description" class="p-2 border rounded w-full mt-2" placeholder="Ù†Ø¸Ø± Ø´Ù…Ø§"></textarea>
        <button onclick="submitReview()" class="bg-green-500 text-white px-4 py-2 rounded mt-2">Ø§Ø±Ø³Ø§Ù„ Ù†Ø¸Ø±</button>
        <!-- Ú©Ù†ØªØ±Ù„ ØªØ¹Ø¯Ø§Ø¯ Ù…Ø­ØµÙˆÙ„ -->
    <div class="flex items-center mt-4">
        <button onclick="changeQuantity(-1)" class="bg-gray-300 px-3 py-1 rounded">-</button>
        <span id="product-quantity" class="mx-4 text-lg">1</span>
        <button onclick="changeQuantity(1)" class="bg-gray-300 px-3 py-1 rounded">+</button>
    </div>

    <!-- Ø¯Ú©Ù…Ù‡ Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ -->
    <button onclick="addToCart()" class="bg-yellow-500 text-white px-4 py-2 rounded mt-4">ğŸ›’ Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</button>

    <a href="http://127.0.0.1:8000/carttt/" class="bg-blue-500 text-white px-4 py-2 rounded mt-4">ğŸ› Ø±ÙØªÙ† Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</a>
{#        <a href="http://127.0.0.1:8000/carttt/" class="bg-yellow-500 text-white px-4 py-2 rounded mt-4">ğŸ› Ø±ÙØªÙ† Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</a>#}

{#        <button onclick="addToCart('PRODUCT_ID')" class="bg-yellow-500 text-white px-3 py-1 rounded mt-2">#}
{#        ğŸ›’ Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯#}
{#        </button>#}

    </div>

    <script>
        const API_URL = "http://127.0.0.1:8000";
        let currentProductId = null;
        let currentQuantity = 1;
        let cartId = null;

    // ØªØ§Ø¨Ø¹ ØªØºÛŒÛŒØ± ØªØ¹Ø¯Ø§Ø¯ Ù…Ø­ØµÙˆÙ„
    function changeQuantity(amount) {
        currentQuantity = Math.max(1, currentQuantity + amount);
        document.getElementById("product-quantity").innerText = currentQuantity;
    }

    async function getOrCreateCart() {
        try {
            let response = await fetch(`${API_URL}/carts/`, { method: "GET" });
            let carts = await response.json();

            if (carts.length > 0) {
                cartId = carts[0].id;
            } else {
                let newCartResponse = await fetch(`${API_URL}/carts/`, { method: "POST" });
                let newCart = await newCartResponse.json();
                cartId = newCart.id;
            }
        } catch (error) {
            console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª ÛŒØ§ Ø§ÛŒØ¬Ø§Ø¯ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯:", error);
        }
    }

    async function addToCart() {
        if (!currentProductId || !cartId) {
            alert("Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ ÛŒØ§ÙØª Ù†Ø´Ø¯! Ù„Ø·ÙØ§Ù‹ ØµÙØ­Ù‡ Ø±Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯.");
            return;
        }

        const data = {
            product_id: currentProductId,
            quantity: currentQuantity
        };

        try {
            const response = await fetch(`${API_URL}/carts/${cartId}/items/`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                alert("Ù…Ø­ØµÙˆÙ„ Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯!");
            } else {
                alert("Ø®Ø·Ø§ Ø¯Ø± Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„ Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯");
            }
        } catch (error) {
            console.error("Ø®Ø·Ø§ Ø¯Ø± Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„ Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯:", error);
        }
    }


        // Ø¯Ø±ÛŒØ§ÙØª Ùˆ Ù†Ù…Ø§ÛŒØ´ Ù„ÛŒØ³Øª Ù…Ø­ØµÙˆÙ„Ø§Øª
        async function loadProducts() {
            try {
                const response = await fetch(`${API_URL}/products/`);
                const products = await response.json();
                renderProducts(products);
            } catch (error) {
                console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù…Ø­ØµÙˆÙ„Ø§Øª:", error);
            }
        }
         // Ø¯Ø±ÛŒØ§ÙØª cart_id Ø¯Ø± Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØµÙØ­Ù‡
    window.onload = getOrCreateCart;

        // Ù†Ù…Ø§ÛŒØ´ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¯Ø± ØµÙØ­Ù‡
        function renderProducts(products) {
    const productsContainer = document.getElementById("products-list");
    productsContainer.innerHTML = "";

    products.forEach(product => {
        const productCard = document.createElement("div");
        productCard.classList.add("bg-white", "p-4", "shadow", "rounded", "relative");

        const imageUrl = `${API_URL}${product.image}`;

        // Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§
        const topDealTag = product.top_deal ? `<span class="absolute top-2 right-2 bg-red-500 text-white text-sm px-2 py-1 rounded">ğŸ”¥ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ ÙˆÛŒÚ˜Ù‡!</span>` : "";
        const flashSalesTag = product.flash_sales ? `<span class="absolute top-2 left-2 bg-yellow-500 text-white text-sm px-2 py-1 rounded">âš¡ ÙØ±ÙˆØ´ ÙˆÛŒÚ˜Ù‡!</span>` : "";
        const discountTag = product.discount ? `<span class="absolute bottom-2 left-2 bg-green-500 text-white text-sm px-2 py-1 rounded">ğŸ·ï¸ ØªØ®ÙÛŒÙ Ø¯Ø§Ø±Ø¯!</span>` : "";


        // Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ
        const inventoryMessage = product.inventory > 0
            ? `<p class="text-gray-600 text-sm">Ù…ÙˆØ¬ÙˆØ¯ÛŒ: ${product.inventory} Ø¹Ø¯Ø¯</p>`
            : `<p class="text-red-500 font-bold">âŒ Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯</p>`;

        // Ø¯Ú©Ù…Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø¬Ø²Ø¦ÛŒØ§Øª (Ø§Ú¯Ù‡ Ù…ÙˆØ¬ÙˆØ¯ÛŒ ØµÙØ± Ø¨Ø§Ø´Ù‡ØŒ ØºÛŒØ±ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´Ù‡)
        const detailsButton = product.inventory > 0
            ? `<button onclick="showProductDetails('${product.id}')" class="bg-blue-500 text-white px-3 py-1 rounded mt-2">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª</button>`
            : `<button class="bg-gray-400 text-white px-3 py-1 rounded mt-2 cursor-not-allowed" disabled>Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯</button>`;

        productCard.innerHTML = `
            <div class="relative">
                ${discountTag}
                ${topDealTag}
                ${flashSalesTag}
                <img src="${product.image}" alt="${product.name}" class="w-full h-48 object-cover rounded">
            </div>
            <h3 class="text-lg font-bold mt-2">${product.name}</h3>
            <p>${product.description}</p>
            <p class="text-green-600 font-bold">${product.price} ØªÙˆÙ…Ø§Ù†</p>
            {#<p class="text-gray-600 text-sm">Ù…ÙˆØ¬ÙˆØ¯ÛŒ: ${product.inventory} Ø¹Ø¯Ø¯</p>#}
            ${inventoryMessage}
            ${detailsButton}
            {#<button onclick="showProductDetails('${product.id}')" class="bg-blue-500 text-white px-3 py-1 rounded mt-2">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª</button>#}
        `;

        productsContainer.appendChild(productCard);
    });
}


        // Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ù…Ø­ØµÙˆÙ„Ø§Øª
        document.getElementById("search").addEventListener("input", function () {
            const searchValue = this.value.toLowerCase();
            fetch(`${API_URL}/products/`)
                .then(res => res.json())
                .then(products => {
                    const filteredProducts = products.filter(product =>
                        product.name.toLowerCase().includes(searchValue)
                    );
                    renderProducts(filteredProducts);
                });
        });

        // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª
        document.getElementById("sort").addEventListener("change", function () {
            const sortType = this.value;

            fetch(`${API_URL}/products/`)
                .then(res => res.json())
                .then(products => {
                    if (sortType === "price-asc") {
                        products.sort((a, b) => a.price - b.price);
                    } else if (sortType === "price-desc") {
                        products.sort((a, b) => b.price - a.price);
                    }
                    renderProducts(products);
                });
        });

        // Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÛŒÚ© Ù…Ø­ØµÙˆÙ„ Ø®Ø§Øµ
        async function showProductDetails(productId) {
            try {
                currentProductId = productId;
                currentQuantity = 1;
            document.getElementById("product-quantity").innerText = currentQuantity;

                const response = await fetch(`${API_URL}/products/${productId}/`);
                const product = await response.json();

                document.getElementById("product-name").innerText = product.name;
                document.getElementById("product-description").innerText = product.description;
                document.getElementById("product-price").innerText = `Ù‚ÛŒÙ…Øª: ${product.price} ØªÙˆÙ…Ø§Ù†`;
                document.getElementById("product-image").src = `${product.image}`;

                document.getElementById("product-details").classList.remove("hidden");

                loadReviews(productId);
            } catch (error) {
                console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø­ØµÙˆÙ„:", error);
            }
        }

        // Ø¯Ø±ÛŒØ§ÙØª Ù†Ø¸Ø±Ø§Øª Ù…Ø­ØµÙˆÙ„
        async function loadReviews(productId) {
            try {
                const response = await fetch(`${API_URL}/products/${productId}/reviews/`);
                const reviews = await response.json();

                const reviewsList = document.getElementById("reviews-list");
                reviewsList.innerHTML = "";

                reviews.forEach(review => {
                    const reviewItem = document.createElement("li");
                    reviewItem.classList.add("border-b", "py-2");
                    reviewItem.innerHTML = `<strong>${review.name}:</strong> ${review.description}`;
                    reviewsList.appendChild(reviewItem);
                });

            } catch (error) {
                console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù†Ø¸Ø±Ø§Øª:", error);
            }
        }

        // Ø§Ø±Ø³Ø§Ù„ Ù†Ø¸Ø± Ø¬Ø¯ÛŒØ¯
        async function submitReview() {
            const name = document.getElementById("review-name").value;
            const description = document.getElementById("review-description").value;

            if (!name || !description) {
                alert("Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ùˆ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");
                return;
            }

            const reviewData = {
                name,
                description
            };

            try {
                await fetch(`${API_URL}/products/${currentProductId}/reviews/`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(reviewData)
                });

                document.getElementById("review-name").value = "";
                document.getElementById("review-description").value = "";

                loadReviews(currentProductId);
            } catch (error) {
                console.error("Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù†Ø¸Ø±:", error);
            }
        }

        // Ø¨Ø³ØªÙ† ØµÙØ­Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª
        function closeDetails() {
            document.getElementById("product-details").classList.add("hidden");
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ù…Ø­ØµÙˆÙ„Ø§Øª
        document.addEventListener("DOMContentLoaded", loadProducts);


    {#    categori#}

        // Ø¯Ø±ÛŒØ§ÙØª Ùˆ Ù†Ù…Ø§ÛŒØ´ Ù„ÛŒØ³Øª Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§
async function loadCategories() {
    try {
        const response = await fetch(`${API_URL}/categories/`);
        const categories = await response.json();
        renderCategories(categories);
    } catch (error) {
        console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§:", error);
    }
}

// Ù†Ù…Ø§ÛŒØ´ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ Ø¯Ø± ØµÙØ­Ù‡
function renderCategories(categories) {
    const categoriesContainer = document.getElementById("categories-list");
    categoriesContainer.innerHTML = "";

    // Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ú©Ù…Ù‡ "Ù‡Ù…Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª"
    const allButton = document.createElement("button");
    allButton.innerText = "Ù‡Ù…Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª";
    allButton.classList.add("bg-gray-300", "px-3", "py-1", "rounded", "cursor-pointer");
    allButton.addEventListener("click", loadProducts);
    categoriesContainer.appendChild(allButton);

    categories.forEach(category => {
        const categoryButton = document.createElement("button");
        categoryButton.innerText = category.title;
        categoryButton.classList.add("bg-blue-500", "text-white", "px-3", "py-1", "rounded", "cursor-pointer");

        categoryButton.addEventListener("click", () => filterProductsByCategory(category.category_id));

        categoriesContainer.appendChild(categoryButton);
    });
}

// ÙÛŒÙ„ØªØ± Ú©Ø±Ø¯Ù† Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
async function filterProductsByCategory(categoryId) {
    try {
        const response = await fetch(`${API_URL}/products/`);
        const products = await response.json();

        // ÙÛŒÙ„ØªØ± Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¨Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ù…Ù‚Ø¯Ø§Ø± null Ø¨Ø±Ø§ÛŒ category
        const filteredProducts = products.filter(product => product.category && product.category.category_id === categoryId);

        renderProducts(filteredProducts);
    } catch (error) {
        console.error("Ø®Ø·Ø§ Ø¯Ø± ÙÛŒÙ„ØªØ± Ù…Ø­ØµÙˆÙ„Ø§Øª:", error);
    }
}


// Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§
document.addEventListener("DOMContentLoaded", loadCategories);

    </script>

</body>
</html>
