<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø¢Ù†Ù„Ø§ÛŒÙ†</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 p-4">
<!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ØŒ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ùˆ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ -->
<div id="auth-buttons">
    <a id="login-btn" href="/choicelog/" class="bg-blue-500 text-white px-4 py-2 rounded">ÙˆØ±ÙˆØ¯</a>
    <a id="signup-btn" href="/req/" class="bg-green-500 text-white px-4 py-2 rounded">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</a>
    <a id="profile-btn" href="/basepro/" class="bg-gray-700 text-white px-4 py-2 rounded hidden">Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ù…Ù†</a>
    <button id="logout-btn" onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded hidden ml-2">Ø®Ø±ÙˆØ¬ Ø§Ø² Ø­Ø³Ø§Ø¨</button>
</div>

<button onclick="checkout()" class="bg-green-500 text-white px-4 py-2 rounded mt-4">
    ØªØ³ÙˆÛŒÙ‡ Ø­Ø³Ø§Ø¨
</button>

<!-- Ø¯Ú©Ù…Ù‡ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ -->
<button id="show-cart-btn" class="bg-blue-500 text-white px-4 py-2 rounded">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</button>

<!-- Ø§ÛŒÙ†Ø¬Ø§ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
<div id="cart-container" class="hidden mt-4 p-4 bg-white shadow rounded w-full">
    <h2 class="text-xl font-bold">Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</h2>
    <div id="cart-items-container" class="space-y-2 mt-2"></div>
    <div id="cart-totall" class="font-bold mt-4"></div>
    <button onclick="checkout()" class="bg-green-500 text-white px-4 py-2 rounded mt-4">
    ØªØ³ÙˆÛŒÙ‡ Ø­Ø³Ø§Ø¨
</button>
    <button id="hide-cart-btn" class="bg-red-500 text-white px-4 py-2 rounded mt-4">Ø¨Ø³ØªÙ† Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</button>
</div>




<!-- Ù‚Ø³Ù…Øª Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ -->
<div class="mb-4">
    <h2 class="text-lg font-bold">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</h2>
    <div id="categories-list" class="flex gap-2 mt-2"></div>
</div>

    <!-- Ù‚Ø³Ù…Øª Ø¬Ø³ØªØ¬Ùˆ Ùˆ Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ -->
    <div class="mb-4 flex gap-2">
        <input type="text" id="search" class="p-2 border rounded w-1/2" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ù…Ø­ØµÙˆÙ„...">
        <select id="sort" class="p-2 border rounded">
            <option value="default">Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ</option>
            <option value="price-asc">Ù‚ÛŒÙ…Øª: Ú©Ù… Ø¨Ù‡ Ø²ÛŒØ§Ø¯</option>
            <option value="price-desc">Ù‚ÛŒÙ…Øª: Ø²ÛŒØ§Ø¯ Ø¨Ù‡ Ú©Ù…</option>
        </select>
    </div>

    <!-- Ù„ÛŒØ³Øª Ù…Ø­ØµÙˆÙ„Ø§Øª -->
    <div id="products-list" class="grid grid-cols-1 md:grid-cols-3 gap-4"></div>

    <!-- Ù†Ù…Ø§ÛŒØ´ Ø¬Ø²Ø¦ÛŒØ§Øª Ù…Ø­ØµÙˆÙ„ -->
    <div id="product-details" class="hidden p-4 bg-white shadow rounded mt-4">
        <button onclick="closeDetails()" class="bg-red-500 text-white px-3 py-1 rounded">Ø¨Ø³ØªÙ†</button>
        <h2 id="product-name" class="text-xl font-bold mt-2"></h2>
        <img id="product-image" class="w-64 h-64 object-cover mt-2" />
        <p id="product-description" class="mt-2"></p>
        <p id="product-price" class="font-bold text-lg mt-2"></p>
        <h3 class="text-lg font-semibold mt-4">Ù†Ø¸Ø±Ø§Øª:</h3>
        <ul id="reviews-list" class="mt-2"></ul>

        <!-- ÙØ±Ù… Ø§ÙØ²ÙˆØ¯Ù† Ù†Ø¸Ø± -->
        <h3 class="text-lg font-semibold mt-4">Ø§ÙØ²ÙˆØ¯Ù† Ù†Ø¸Ø± Ø¬Ø¯ÛŒØ¯:</h3>
        <input type="text" id="review-name" class="p-2 border rounded w-full mt-2" placeholder="Ù†Ø§Ù… Ø´Ù…Ø§">
        <textarea id="review-description" class="p-2 border rounded w-full mt-2" placeholder="Ù†Ø¸Ø± Ø´Ù…Ø§"></textarea>
        <button onclick="submitReview()" class="bg-green-500 text-white px-4 py-2 rounded mt-2">Ø§Ø±Ø³Ø§Ù„ Ù†Ø¸Ø±</button>
        <!-- Ú©Ù†ØªØ±Ù„ ØªØ¹Ø¯Ø§Ø¯ Ù…Ø­ØµÙˆÙ„ -->
    <div class="flex items-center mt-4">
        <button onclick="changeQuantity(-1)" class="bg-gray-300 px-3 py-1 rounded">-</button>
        <span id="product-quantity" class="mx-4 text-lg">1</span>
        <button onclick="changeQuantity(1)" class="bg-gray-300 px-3 py-1 rounded">+</button>
    </div>

    <!-- Ø¯Ú©Ù…Ù‡ Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ -->
    <button onclick="addToCart()" class="bg-yellow-500 text-white px-4 py-2 rounded mt-4">ğŸ›’ Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</button>


        <!-- Ù†Ù…Ø§ÛŒØ´ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ -->
<div id="cart-summary" class="p-4 bg-white shadow rounded mt-4">
    <h2 class="text-xl font-bold">Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</h2>
    <div id="cart-items" class="mt-4"></div>
    <div id="cart-total" class="mt-4 text-lg font-bold"></div>
{#    <button onclick="clearCart()" class="bg-red-500 text-white px-4 py-2 rounded mt-4">Ø­Ø°Ù ØªÙ…Ø§Ù… Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§</button>#}
    <button onclick="checkout()" class="bg-green-500 text-white px-4 py-2 rounded mt-4">
    ØªØ³ÙˆÛŒÙ‡ Ø­Ø³Ø§Ø¨
</button>

</div>

{#        <a href="http://127.0.0.1:8000/carttt/" class="bg-yellow-500 text-white px-4 py-2 rounded mt-4">ğŸ› Ø±ÙØªÙ† Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</a>#}

{#        <button onclick="addToCart('PRODUCT_ID')" class="bg-yellow-500 text-white px-3 py-1 rounded mt-2">#}
{#        ğŸ›’ Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯#}
{#        </button>#}

    </div>

    <script>
        const API_URL = "http://localhost";
        let currentProductId = null;
        let currentQuantity = 1;
        let cartId = null;

    document.addEventListener("DOMContentLoaded", function () {
    const token = localStorage.getItem("access_token");

    if (token) {
        document.getElementById("profile-btn").classList.remove("hidden");
        document.getElementById("logout-btn").classList.remove("hidden");  // Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡
        document.getElementById("login-btn").classList.add("hidden");
        document.getElementById("signup-btn").classList.add("hidden");
    }
});

    async function logout() {
        const refreshToken = localStorage.getItem("refresh_token");

        if (!refreshToken) {
            // ÙÙ‚Ø· ØªÙˆÚ©Ù† access Ù‡Ø³ØªØŸ Ø¨ÙØ±Ø³ØªØ´ Ø¨Ù‡ Ù„Ø§Ú¯ÛŒÙ†
            localStorage.removeItem("access_token");
            window.location.href = "http://localhost/pproductt/";
            return;
        }

        try {
            const response = await fetch("http://localhost/logout/", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ refresh_token: refreshToken }),
            });

            // Ú†Ù‡ Ù…ÙˆÙÙ‚ Ø¨Ø§Ø´Ù‡ Ú†Ù‡ Ù†Ù‡ØŒ ØªÙˆÚ©Ù†â€ŒÙ‡Ø§ Ø±Ùˆ Ù¾Ø§Ú© Ú©Ù†
            localStorage.removeItem("access_token");
            localStorage.removeItem("refresh_token");
            window.location.href = "http://localhost/pproductt/";
        } catch (error) {
            console.error("Ø®Ø·Ø§ Ø¯Ø± Ø®Ø±ÙˆØ¬ Ø§Ø² Ø­Ø³Ø§Ø¨:", error);
            localStorage.removeItem("access_token");
            localStorage.removeItem("refresh_token");
            window.location.href = "http://localhost/pproductt/";
        }
    }
{#    if (token) {#}
{#        // Ø§Ú¯Ø± ØªÙˆÚ©Ù† ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ØŒ Ù„ÛŒÙ†Ú© Ø±Ø§ Ø¨Ù‡ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†#}
{#        profileBtn.href = "http://127.0.0.1:8000/basepro/";#}
{#    } else {#}
{#        // Ø§Ú¯Ø± ØªÙˆÚ©Ù† ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯ØŒ Ù„ÛŒÙ†Ú© Ø±Ø§ Ø¨Ù‡ Ù„Ø§Ú¯ÛŒÙ† ØªÙ†Ø¸ÛŒÙ… Ú©Ù†#}
{#        profileBtn.href = "http://127.0.0.1:8000/choicelog/";#}
{#    }#}


    // ØªØ§Ø¨Ø¹ ØªØºÛŒÛŒØ± ØªØ¹Ø¯Ø§Ø¯ Ù…Ø­ØµÙˆÙ„
    function changeQuantity(amount) {
        currentQuantity = Math.max(1, currentQuantity + amount);
        document.getElementById("product-quantity").innerText = currentQuantity;
    }

    async function getOrCreateCart() {
        try {
            let response = await fetch(`${API_URL}/carts/`, { method: "GET" });
            let carts = await response.json();

            if (carts.length > 0) {
                cartId = carts[0].id;
            } else {
                let newCartResponse = await fetch(`${API_URL}/carts/`, { method: "POST" });
                let newCart = await newCartResponse.json();
                cartId = newCart.id;
            }
        } catch (error) {
            console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª ÛŒØ§ Ø§ÛŒØ¬Ø§Ø¯ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯:", error);
        }
    }

    async function addToCart() {
    if (!currentProductId || !cartId) {
        alert("Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ ÛŒØ§ÙØª Ù†Ø´Ø¯! Ù„Ø·ÙØ§Ù‹ ØµÙØ­Ù‡ Ø±Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯.");
        return;
    }

    const data = {
        product_id: currentProductId,
        quantity: currentQuantity
    };

    try {
        const response = await fetch(`${API_URL}/carts/${cartId}/items/`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(data)
        });

        if (response.ok) {
            alert("Ù…Ø­ØµÙˆÙ„ Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯!");
            loadCartItems(); // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø¨Ø¯ÙˆÙ† Ø±ÙØ±Ø´ ØµÙØ­Ù‡
        } else {
            alert("Ø®Ø·Ø§ Ø¯Ø± Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„ Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯");
        }
    } catch (error) {
        console.error("Ø®Ø·Ø§ Ø¯Ø± Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„ Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯:", error);
    }
}



        // Ø¯Ø±ÛŒØ§ÙØª Ùˆ Ù†Ù…Ø§ÛŒØ´ Ù„ÛŒØ³Øª Ù…Ø­ØµÙˆÙ„Ø§Øª
        async function loadProducts() {
            try {
                const response = await fetch(`${API_URL}/products/`);
                const products = await response.json();
                renderProducts(products);
            } catch (error) {
                console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù…Ø­ØµÙˆÙ„Ø§Øª:", error);
            }
        }
         // Ø¯Ø±ÛŒØ§ÙØª cart_id Ø¯Ø± Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØµÙØ­Ù‡
    window.onload = getOrCreateCart;

        // Ù†Ù…Ø§ÛŒØ´ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¯Ø± ØµÙØ­Ù‡
        function renderProducts(products) {
    const productsContainer = document.getElementById("products-list");
    productsContainer.innerHTML = "";

    products.forEach(product => {
        const productCard = document.createElement("div");
        productCard.classList.add("bg-white", "p-4", "shadow", "rounded", "relative");

        const imageUrl = `${API_URL}${product.image}`;

        // Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§
        const topDealTag = product.top_deal ? `<span class="absolute top-2 right-2 bg-red-500 text-white text-sm px-2 py-1 rounded">ğŸ”¥ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ ÙˆÛŒÚ˜Ù‡!</span>` : "";
        const flashSalesTag = product.flash_sales ? `<span class="absolute top-2 left-2 bg-yellow-500 text-white text-sm px-2 py-1 rounded">âš¡ ÙØ±ÙˆØ´ ÙˆÛŒÚ˜Ù‡!</span>` : "";
        const discountTag = product.discount ? `<span class="absolute bottom-2 left-2 bg-green-500 text-white text-sm px-2 py-1 rounded">ğŸ·ï¸ ØªØ®ÙÛŒÙ Ø¯Ø§Ø±Ø¯!</span>` : "";


        // Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ
        const inventoryMessage = product.inventory > 0
            ? `<p class="text-gray-600 text-sm">Ù…ÙˆØ¬ÙˆØ¯ÛŒ: ${product.inventory} Ø¹Ø¯Ø¯</p>`
            : `<p class="text-red-500 font-bold">âŒ Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯</p>`;

        // Ø¯Ú©Ù…Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø¬Ø²Ø¦ÛŒØ§Øª (Ø§Ú¯Ù‡ Ù…ÙˆØ¬ÙˆØ¯ÛŒ ØµÙØ± Ø¨Ø§Ø´Ù‡ØŒ ØºÛŒØ±ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´Ù‡)
        const detailsButton = product.inventory > 0
            ? `<button onclick="showProductDetails('${product.id}')" class="bg-blue-500 text-white px-3 py-1 rounded mt-2">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª</button>`
            : `<button class="bg-gray-400 text-white px-3 py-1 rounded mt-2 cursor-not-allowed" disabled>Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯</button>`;

        productCard.innerHTML = `
            <div class="relative">
                ${discountTag}
                ${topDealTag}
                ${flashSalesTag}
                <img src="${product.image}" alt="${product.name}" class="w-full h-48 object-cover rounded">
            </div>
            <h3 class="text-lg font-bold mt-2">${product.name}</h3>
            <p>${product.description}</p>
            <p class="text-green-600 font-bold">${product.price} ØªÙˆÙ…Ø§Ù†</p>
            {#<p class="text-gray-600 text-sm">Ù…ÙˆØ¬ÙˆØ¯ÛŒ: ${product.inventory} Ø¹Ø¯Ø¯</p>#}
            ${inventoryMessage}
            ${detailsButton}
            {#<button onclick="showProductDetails('${product.id}')" class="bg-blue-500 text-white px-3 py-1 rounded mt-2">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª</button>#}
        `;

        productsContainer.appendChild(productCard);
    });
}


        // Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ù…Ø­ØµÙˆÙ„Ø§Øª
        document.getElementById("search").addEventListener("input", function () {
            const searchValue = this.value.toLowerCase();
            fetch(`${API_URL}/products/`)
                .then(res => res.json())
                .then(products => {
                    const filteredProducts = products.filter(product =>
                        product.name.toLowerCase().includes(searchValue)
                    );
                    renderProducts(filteredProducts);
                });
        });

        // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª
        document.getElementById("sort").addEventListener("change", function () {
            const sortType = this.value;

            fetch(`${API_URL}/products/`)
                .then(res => res.json())
                .then(products => {
                    if (sortType === "price-asc") {
                        products.sort((a, b) => a.price - b.price);
                    } else if (sortType === "price-desc") {
                        products.sort((a, b) => b.price - a.price);
                    }
                    renderProducts(products);
                });
        });

        // Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÛŒÚ© Ù…Ø­ØµÙˆÙ„ Ø®Ø§Øµ
        async function showProductDetails(productId) {
            try {
                currentProductId = productId;
                currentQuantity = 1;
            document.getElementById("product-quantity").innerText = currentQuantity;

                const response = await fetch(`${API_URL}/products/${productId}/`);
                const product = await response.json();

                document.getElementById("product-name").innerText = product.name;
                document.getElementById("product-description").innerText = product.description;
                document.getElementById("product-price").innerText = `Ù‚ÛŒÙ…Øª: ${product.price} ØªÙˆÙ…Ø§Ù†`;
                document.getElementById("product-image").src = `${product.image}`;

                document.getElementById("product-details").classList.remove("hidden");

                loadReviews(productId);
            } catch (error) {
                console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø­ØµÙˆÙ„:", error);
            }
        }

        // Ø¯Ø±ÛŒØ§ÙØª Ù†Ø¸Ø±Ø§Øª Ù…Ø­ØµÙˆÙ„
        async function loadReviews(productId) {
            try {
                const response = await fetch(`${API_URL}/products/${productId}/reviews/`);
                const reviews = await response.json();

                const reviewsList = document.getElementById("reviews-list");
                reviewsList.innerHTML = "";

                reviews.forEach(review => {
                    const reviewItem = document.createElement("li");
                    reviewItem.classList.add("border-b", "py-2");
                    reviewItem.innerHTML = `<strong>${review.name}:</strong> ${review.description}`;
                    reviewsList.appendChild(reviewItem);
                });

            } catch (error) {
                console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù†Ø¸Ø±Ø§Øª:", error);
            }
        }

        // Ø§Ø±Ø³Ø§Ù„ Ù†Ø¸Ø± Ø¬Ø¯ÛŒØ¯
        async function submitReview() {
            const name = document.getElementById("review-name").value;
            const description = document.getElementById("review-description").value;

            if (!name || !description) {
                alert("Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ùˆ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");
                return;
            }

            const reviewData = {
                name,
                description
            };

            try {
                await fetch(`${API_URL}/products/${currentProductId}/reviews/`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(reviewData)
                });

                document.getElementById("review-name").value = "";
                document.getElementById("review-description").value = "";

                loadReviews(currentProductId);
            } catch (error) {
                console.error("Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù†Ø¸Ø±:", error);
            }
        }

        // Ø¨Ø³ØªÙ† ØµÙØ­Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª
        function closeDetails() {
            document.getElementById("product-details").classList.add("hidden");
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ù…Ø­ØµÙˆÙ„Ø§Øª
        document.addEventListener("DOMContentLoaded", loadProducts);

    {# carttttt#}

// ØªØ§Ø¨Ø¹ Ø°Ø®ÛŒØ±Ù‡ Ú©Ø±Ø¯Ù† Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø¯Ø± localStorage
function saveCartToLocalStorage(cartItems) {
    localStorage.setItem("cart_items", JSON.stringify(cartItems));
}

// Ø®ÙˆØ§Ù†Ø¯Ù† Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø§Ø² localStorage
function getCartItemsFromLocalStorage() {
    return JSON.parse(localStorage.getItem("cart_items")) || [];
}



 // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ùˆ Ù†Ù…Ø§ÛŒØ´ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§
async function loadCartItems() {
    if (!cartId) {
        alert("Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ ÛŒØ§ÙØª Ù†Ø´Ø¯! Ù„Ø·ÙØ§Ù‹ ØµÙØ­Ù‡ Ø±Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯.");
        return;
    }

    try {
        const response = await fetch(`${API_URL}/carts/${cartId}/items/`);
        const cartItems = await response.json();
        renderCartItems(cartItems);  // Ù†Ù…Ø§ÛŒØ´ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø¯Ø± UI
        saveCartToLocalStorage(cartItems);
    } catch (error) {
        console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯:", error);
    }
}


// Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø¯Ø± Ø¨Ø§Ù„Ø§ÛŒ ØµÙØ­Ù‡
function updateCartSummary(cartItems) {
    const cartSummary = document.getElementById("cart-summary");
    const totalItems = cartItems.reduce((acc, item) => acc + item.quantity, 0);
    const totalPrice = cartItems.reduce((acc, item) => acc + (item.quantity * item.product.price), 0);

    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ù…Ø­ØµÙˆÙ„Ø§Øª Ùˆ Ù‚ÛŒÙ…Øª Ú©Ù„ Ø¯Ø± Ø¨Ø§Ù„Ø§ÛŒ ØµÙØ­Ù‡
    cartSummary.innerHTML = `
        <p>ØªØ¹Ø¯Ø§Ø¯ Ù…Ø­ØµÙˆÙ„Ø§Øª: ${totalItems}</p>
        <p>Ù…Ø¬Ù…ÙˆØ¹ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯: ${totalPrice} ØªÙˆÙ…Ø§Ù†</p>
    `;
}

// Ù†Ù…Ø§ÛŒØ´ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯
function renderCartItems(cartItems) {
    const cartItemsContainer = document.getElementById("cart-items");
    cartItemsContainer.innerHTML = "";

    if (cartItems.length === 0) {
        cartItemsContainer.innerHTML = "<p>Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø´Ù…Ø§ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª.</p>";
        document.getElementById("cart-total").innerText = "";
        return;
    }

    let total = 0;

    cartItems.forEach(item => {
        const itemTotal = item.quantity * item.product.price;
        total += itemTotal;

        const itemElement = document.createElement("div");
        itemElement.classList.add("flex", "justify-between", "items-center", "border-b", "py-2");

        itemElement.innerHTML = `
            <div>
                <h4 class="text-lg font-bold">${item.product.name}</h4>
                <p class="text-gray-600">ØªØ¹Ø¯Ø§Ø¯: ${item.quantity}</p>
                <p class="text-gray-500">Ù‚ÛŒÙ…Øª ÙˆØ§Ø­Ø¯: ${item.product.price} ØªÙˆÙ…Ø§Ù†</p>
            </div>
            <div>
                <p class="font-bold">${itemTotal} ØªÙˆÙ…Ø§Ù†</p>
            </div>
            <div class="flex items-center">
                <button onclick="updateItemQuantity('${item.id}', ${item.quantity - 1})" class="bg-gray-300 px-2 py-1 rounded">-</button>
                <span class="mx-2">${item.quantity}</span>
                <button onclick="updateItemQuantity('${item.id}', ${item.quantity + 1})" class="bg-gray-300 px-2 py-1 rounded">+</button>
                <button onclick="removeItemFromCart('${item.id}')" class="bg-red-500 text-white px-2 py-1 rounded ml-2">Ø­Ø°Ù</button>
            </div>
        `;

        cartItemsContainer.appendChild(itemElement);
    });

    document.getElementById("cart-total").innerText = `Ù…Ø¬Ù…ÙˆØ¹ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯: ${total} ØªÙˆÙ…Ø§Ù†`;
}

async function updateItemQuantity(itemId, newQuantity, maxQuantity) {
    if (newQuantity > maxQuantity) {
        alert("Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª!");
        return;
    }

    try {
        const response = await fetch(`${API_URL}/carts/${cartId}/items/${itemId}/`, {
            method: newQuantity < 1 ? "DELETE" : "PATCH", // Ø§Ú¯Ø± Ú©Ù…ØªØ± Ø§Ø² Û± Ø¨ÙˆØ¯ØŒ Ø­Ø°Ù Ú©Ù†
            headers: { "Content-Type": "application/json" },
            body: newQuantity < 1 ? null : JSON.stringify({ quantity: newQuantity }),
        });

        if (!response.ok) {
            throw new Error("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ø¢ÛŒØªÙ…");
        }

        loadCartItems(); // Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø±Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†
    } catch (error) {
        console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ø¢ÛŒØªÙ…:", error);
    }
}




async function removeItemFromCart(itemId) {
    try {
        await fetch(`${API_URL}/carts/${cartId}/items/${itemId}`, {
            method: "DELETE"
        });
        loadCartItems();

    } catch (error) {
        console.error("Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ø¢ÛŒØªÙ…:", error);
    }
}

async function clearCart() {
    try {
        await fetch(`${API_URL}/carts/${cartId}/clear/`, { method: "DELETE" });
        loadCartItems();
    } catch (error) {
        console.error("Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù ØªÙ…Ø§Ù…ÛŒ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§:", error);

    }
}


// ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ù‡Ù†Ú¯Ø§Ù… ÙˆØ±ÙˆØ¯ Ø¨Ù‡ ØµÙØ­Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯
document.addEventListener("DOMContentLoaded", async () => {
    await getOrCreateCart();  // Ø§ÛŒØ¬Ø§Ø¯ ÛŒØ§ Ø¯Ø±ÛŒØ§ÙØª Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯
    loadCartItems();  // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ùˆ Ù†Ù…Ø§ÛŒØ´ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯
});


function checkout() {
    const token = localStorage.getItem("access_token");

    if (token) {
        // Ø§Ú¯Ø± ØªÙˆÚ©Ù† ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªØŒ Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ Ø¨Ù‡ ØµÙØ­Ù‡ ØªØ³ÙˆÛŒÙ‡ Ø­Ø³Ø§Ø¨ Ù‡Ø¯Ø§ÛŒØª Ú©Ù†
        window.location.href = "http://localhost/check/";  // Ù…Ø³ÛŒØ± ØµÙØ­Ù‡ ØªØ³ÙˆÛŒÙ‡ Ø­Ø³Ø§Ø¨
    } else {
        // Ø§Ú¯Ø± Ù„Ø§Ú¯ÛŒÙ† Ù†ÛŒØ³ØªØŒ Ø¨Ù‡ ØµÙØ­Ù‡ Ù„Ø§Ú¯ÛŒÙ† Ù‡Ø¯Ø§ÛŒØª Ø´ÙˆØ¯
        window.location.href = "http://localhost/choicelog/";  // Ù…Ø³ÛŒØ± ØµÙØ­Ù‡ Ù„Ø§Ú¯ÛŒÙ†
    }
}



    {#namayesh safeye asli#}


// ğŸš€ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ùˆ Ù†Ù…Ø§ÛŒØ´ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯
async function loadCartItemss() {
    try {
        const response = await fetch(`${API_URL}/carts/${cartId}/items/`);
        const cartItems = await response.json();

        const cartContainer = document.getElementById("cart-items-container");
        cartContainer.innerHTML = ""; // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„ÛŒØ³Øª Ù‚Ø¨Ù„ÛŒ

        if (cartItems.length === 0) {
            cartContainer.innerHTML = "<p>Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø´Ù…Ø§ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª.</p>";
            document.getElementById("cart-totall").innerText = "";
            return;
        }

        let total = 0;
        cartItems.forEach(item => {
            total += item.quantity * item.product.price;

            const itemElement = document.createElement("div");
            itemElement.classList.add("flex", "justify-between", "items-center", "border-b", "py-2");

            itemElement.innerHTML = `
                <div>
                    <h4 class="text-lg font-bold">${item.product.name}</h4>
                    <p class="text-gray-600">ØªØ¹Ø¯Ø§Ø¯: <span id="quantity-${item.id}">${item.quantity}</span></p>
                    <p class="text-gray-500">Ù‚ÛŒÙ…Øª ÙˆØ§Ø­Ø¯: ${item.product.price} ØªÙˆÙ…Ø§Ù†</p>
                </div>
                <div>
                    <button onclick="updateItemQuantityy('${item.id}', ${item.quantity - 1}, ${item.product.inventory})" class="bg-red-500 text-white px-2 py-1 rounded">-</button>
                    <span class="mx-2">${item.quantity}</span>
                    <button onclick="updateItemQuantityy('${item.id}', ${item.quantity + 1}, ${item.product.inventory})" class="bg-green-500 text-white px-2 py-1 rounded">+</button>
                    <button onclick="removeItem('${item.id}')" class="bg-gray-500 text-white px-2 py-1 rounded">ğŸ—‘ Ø­Ø°Ù</button>
                </div>
            `;

            cartContainer.appendChild(itemElement);
        });

        document.getElementById("cart-totall").innerText = `Ù…Ø¬Ù…ÙˆØ¹: ${total} ØªÙˆÙ…Ø§Ù†`;

    } catch (error) {
        console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯:", error);
    }
}

// ğŸš€ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ù…Ø­ØµÙˆÙ„ Ø¯Ø± Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯
async function updateItemQuantityy(itemId, newQuantity, inventory) {
    if (newQuantity < 1) {
        removeItem(itemId);  // Ø§Ú¯Ø± ØªØ¹Ø¯Ø§Ø¯ Ú©Ù…ØªØ± Ø§Ø² Û± Ø´Ø¯ØŒ Ø­Ø°Ù Ú©Ù†
        return;
    }

    if (newQuantity > inventory) {
        alert("ğŸš« Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª!");
        return;
    }

    try {
        const response = await fetch(`${API_URL}/carts/${cartId}/items/${itemId}/`, {
            method: "PATCH",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ quantity: newQuantity }),
        });

        if (!response.ok) throw new Error("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ø¢ÛŒØªÙ…");

        // ğŸ‘Œ Ø¨Ø¯ÙˆÙ† Ø±ÙØ±Ø´ ØµÙØ­Ù‡ØŒ Ù…Ù‚Ø¯Ø§Ø± Ø¬Ø¯ÛŒØ¯ Ø±Ø§ ØªØºÛŒÛŒØ± Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
        document.getElementById(`quantity-${itemId}`).innerText = newQuantity;
        loadCartItemss(); // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù‚ÛŒÙ…Øª Ú©Ù„

    } catch (error) {
        console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ø¢ÛŒØªÙ…:", error);
    }
}

// ğŸš€ Ø­Ø°Ù ÛŒÚ© Ø¢ÛŒØªÙ… Ø§Ø² Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯
async function removeItem(itemId) {
    try {
        const response = await fetch(`${API_URL}/carts/${cartId}/items/${itemId}/`, {
            method: "DELETE",
        });

        if (!response.ok) throw new Error("Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ø¢ÛŒØªÙ…");

        loadCartItemss(); // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø±ÙØ±Ø´

    } catch (error) {
        console.error("Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ø¢ÛŒØªÙ…:", error);
    }
}


        {#dokme #}

document.getElementById("show-cart-btn").addEventListener("click", async () => {
    await loadCartItemss();
    document.getElementById("cart-container").classList.remove("hidden");
});

document.getElementById("hide-cart-btn").addEventListener("click", () => {
    document.getElementById("cart-container").classList.add("hidden");
});





    {#asdfg#}



    {#    categori#}

        // Ø¯Ø±ÛŒØ§ÙØª Ùˆ Ù†Ù…Ø§ÛŒØ´ Ù„ÛŒØ³Øª Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§
async function loadCategories() {
    try {
        const response = await fetch(`${API_URL}/categories/`);
        const categories = await response.json();
        renderCategories(categories);
    } catch (error) {
        console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§:", error);
    }
}

// Ù†Ù…Ø§ÛŒØ´ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ Ø¯Ø± ØµÙØ­Ù‡
function renderCategories(categories) {
    const categoriesContainer = document.getElementById("categories-list");
    categoriesContainer.innerHTML = "";

    // Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ú©Ù…Ù‡ "Ù‡Ù…Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª"
    const allButton = document.createElement("button");
    allButton.innerText = "Ù‡Ù…Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª";
    allButton.classList.add("bg-gray-300", "px-3", "py-1", "rounded", "cursor-pointer");
    allButton.addEventListener("click", loadProducts);
    categoriesContainer.appendChild(allButton);

    categories.forEach(category => {
        const categoryButton = document.createElement("button");
        categoryButton.innerText = category.title;
        categoryButton.classList.add("bg-blue-500", "text-white", "px-3", "py-1", "rounded", "cursor-pointer");

        categoryButton.addEventListener("click", () => filterProductsByCategory(category.category_id));

        categoriesContainer.appendChild(categoryButton);
    });
}

// ÙÛŒÙ„ØªØ± Ú©Ø±Ø¯Ù† Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
async function filterProductsByCategory(categoryId) {
    try {
        const response = await fetch(`${API_URL}/products/`);
        const products = await response.json();

        // ÙÛŒÙ„ØªØ± Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¨Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ù…Ù‚Ø¯Ø§Ø± null Ø¨Ø±Ø§ÛŒ category
        const filteredProducts = products.filter(product => product.category && product.category.category_id === categoryId);

        renderProducts(filteredProducts);
    } catch (error) {
        console.error("Ø®Ø·Ø§ Ø¯Ø± ÙÛŒÙ„ØªØ± Ù…Ø­ØµÙˆÙ„Ø§Øª:", error);
    }
}


// Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§
document.addEventListener("DOMContentLoaded", loadCategories);

    </script>

</body>
</html>
